import org.openhab.core.library.types.*
import org.openhab.model.script.actions.*
import org.openhab.core.persistence.*

// Sending Commands for Home Theater to Receiver

rule "Home Theater Mode"
  when
    Item Home_Theater_Mode received update or
    Item integraPower received update or
    Item integraSource received update
  then
    if (Home_Theater_Mode.state == 0) {
      if (integraPower.state == ON) {
        sendCommand(integraPower, OFF)
      }
    } else if (Home_Theater_Mode.state == 1) {
      if (integraPower.state == OFF) {
        sendCommand(integraPower, ON)
      }
      if (integraSource.state != 1) {
        sendCommand(integraSource, 1)
      }
    } else if (Home_Theater_Mode.state == 2) {
      if (integraPower.state == OFF) {
        sendCommand(integraPower, ON)
      }
      if (integraSource.state != 2) {
        sendCommand(integraSource, 2)
      }
    } else if (Home_Theater_Mode.state == 2) {
      if (integraPower.state == OFF) {
        sendCommand(integraPower, ON)
      }
      if (integraSource.state != 11) {
        sendCommand(integraSource, 11)
      }
    } else if (Home_Theater_Mode.state == 3) {
      if (integraPower.state == OFF) {
        sendCommand(integraPower, ON)
      }
      if (integraSource.state != 5) {
        sendCommand(integraSource, 5)
      }
    } else if (Home_Theater_Mode.state == 4) {
      if (integraPower.state == OFF) {
        sendCommand(integraPower, ON)
      }
      if (integraSource.state != 43) {
        sendCommand(integraSource, 43)
      }
    } else if (Home_Theater_Mode.state == 5) {
      if (integraPower.state == OFF) {
        sendCommand(integraPower, ON)
      }
      if (integraSource.state != 43) {
        sendCommand(integraSource, 43)
      }
    }
  end

// Sending Commands for Bar Speaker Mode to Receiver

rule "Bar Speakers OFF Mode"
  when
    Item Bar_Speaker_Mode received update 0
  then
    sendCommand(integraZ2Power, OFF)
  end
  
rule "Bar Speakers Pandora Mode"
  when
    Item Bar_Speaker_Mode received update 4
  then
    sendCommand(integraZ2Power, ON)
    sendCommand(integraZ2Source, 43)
  end
  
// Check Receiver and make sure Bar_Speaker_Mode reflects correct mode

rule "Set Bar Speaker Mode OFF"
  when
    Item integraZ2Power changed from ON to OFF
  then
    sendCommand(Bar_Speaker_Mode, 0)
  end
  
rule "Set Bar Speaker Mode Pandora"
  when
    Item integraZ2Power received update ON and
    Item integraZ2Source received update 43
  then
    sendCommand(Bar_Speaker_Mode, 4)
  end
